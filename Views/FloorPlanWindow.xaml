<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:Wpf="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf" 
        x:Class="Kiosk.FloorPlanWindow"
        Title="Карта здания" 
        WindowState="Maximized" 
        WindowStyle="None"
        Background="#2c3e50"
        PreviewMouseWheel="Window_PreviewMouseWheel"
        PreviewMouseDown="Window_PreviewMouseDown"
        PreviewMouseMove="Window_PreviewMouseMove"
        PreviewMouseUp="Window_PreviewMouseUp"
        MouseRightButtonDown="Window_MouseRightButtonDown"
        MouseRightButtonUp="Window_MouseRightButtonUp"
        TouchDown="Window_TouchDown"
        TouchMove="Window_TouchMove"
        TouchUp="Window_TouchUp">

    <Window.Resources>
        <Style x:Key="ZoomButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="#34495e" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="FontSize" Value="20" />
            <Setter Property="Width" Value="60" />
            <Setter Property="Height" Value="60" />
            <Setter Property="Cursor" Value="Hand" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4a6572" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Основная область для отображения этажей -->
        <ScrollViewer x:Name="MainScrollViewer"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      Background="#1e2a36"
                      PanningMode="Both"
                      IsManipulationEnabled="True"
                      ManipulationDelta="MainScrollViewer_ManipulationDelta"
                      ManipulationStarting="MainScrollViewer_ManipulationStarting"
                      PreviewMouseDown="ScrollViewer_PreviewMouseDown"
                      PreviewTouchDown="ScrollViewer_PreviewTouchDown">

            <!-- Контейнер для контента с поддержкой манипуляций -->
            <Grid x:Name="ContentGrid"
                  Background="Transparent"
                  IsManipulationEnabled="True">

                <Viewbox x:Name="FloorViewbox" 
                         Stretch="Uniform"
                         RenderTransformOrigin="0.5,0.5">
                    <Viewbox.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform x:Name="ViewboxScaleTransform" 
                                           ScaleX="1" 
                                           ScaleY="1" />
                            <TranslateTransform x:Name="ViewboxTranslateTransform" 
                                               X="0" 
                                               Y="0" />
                        </TransformGroup>
                    </Viewbox.RenderTransform>

                    <!-- Используем Frame для отображения страниц -->
                    <Frame x:Name="FloorFrame"
                           NavigationUIVisibility="Hidden" />
                </Viewbox>
            </Grid>
        </ScrollViewer>

        <!-- ПАНЕЛЬ УПРАВЛЕНИЯ ПОВЕРХ КАРТЫ -->
        <Grid>
            <!-- Верхняя панель управления -->
            <Border Background="#34495e" 
                    Padding="25" 
                    Height="120"
                    VerticalAlignment="Top">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Селектор этажей -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Этаж:" 
                                   Foreground="White" 
                                   FontSize="22" 
                                   VerticalAlignment="Center"
                                   Margin="0,0,20,0" />
                        <ComboBox x:Name="FloorSelector" 
                                  SelectionChanged="FloorSelector_SelectionChanged"
                                  Width="180" 
                                  Height="50" 
                                  FontSize="18" 
                                  Padding="15,8">
                            <ComboBoxItem Content="1 Этаж" Tag="Floor1.xaml" IsSelected="True" />
                            <ComboBoxItem Content="2 Этаж" Tag="Floor2.xaml" />
                            <ComboBoxItem Content="3 Этаж" Tag="Floor3.xaml" />
                            <ComboBoxItem Content="4 Этаж" Tag="Floor4.xaml" />
                        </ComboBox>
                    </StackPanel>

                    <!-- Панель масштабирования -->
                    <StackPanel Grid.Column="1" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center" 
                                VerticalAlignment="Center">
                        <Button x:Name="ZoomOutBtn" 
                                Content="➖" 
                                Click="ZoomOutBtn_Click"
                                Style="{StaticResource ZoomButtonStyle}"
                                Margin="0,0,15,0"
                                ToolTip="Уменьшить" />

                        <TextBlock Text="Масштаб:" 
                                   Foreground="White" 
                                   FontSize="18" 
                                   VerticalAlignment="Center"
                                   Margin="20,0,15,0" />

                        <Slider x:Name="ZoomSlider" 
                                Minimum="0.3" 
                                Maximum="3.0" 
                                Value="1.0"
                                Width="150" 
                                Height="40" 
                                VerticalAlignment="Center"
                                ValueChanged="ZoomSlider_ValueChanged" />

                        <TextBlock x:Name="ZoomText" 
                                   Text="100%" 
                                   Foreground="White" 
                                   FontSize="18" 
                                   VerticalAlignment="Center"
                                   Margin="15,0,20,0"
                                   Width="60" />

                        <Button x:Name="ZoomInBtn" 
                                Content="➕" 
                                Click="ZoomInBtn_Click"
                                Style="{StaticResource ZoomButtonStyle}"
                                Margin="0,0,15,0"
                                ToolTip="Увеличить" />

                        <Button x:Name="ResetZoomBtn" 
                                Content="🔍" 
                                Click="ResetZoomBtn_Click"
                                Style="{StaticResource ZoomButtonStyle}"
                                ToolTip="Сбросить масштаб" />

                        <!-- Кнопка сброса перемещения -->
                        <Button x:Name="ResetPanBtn" 
                                Content="🎯" 
                                Click="ResetPanBtn_Click"
                                Style="{StaticResource ZoomButtonStyle}"
                                Margin="15,0,0,0"
                                ToolTip="Сбросить позицию" />
                    </StackPanel>

                    <!-- Кнопка выхода -->
                    <Button x:Name="ExitButton"
                            Grid.Column="2"
                            Content="Выйти" 
                            Click="ExitButton_Click"
                            Padding="25,15"
                            Background="#e74c3c"
                            Foreground="White"
                            FontSize="18" 
                            FontWeight="SemiBold"
                            BorderThickness="0"
                            MinWidth="120" 
                            MinHeight="55"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Cursor="Hand">
                        <Button.Effect>
                            <Wpf:TintEffect/>
                        </Button.Effect>
                    </Button>
                </Grid>
            </Border>
        </Grid>

        <!-- Индикатор сенсорного управления -->
        <Border x:Name="TouchOperationIndicator"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,140,0,0"
                Background="#34495e"
                CornerRadius="15"
                Padding="20"
                Visibility="Collapsed"
                Opacity="0.9"
                Panel.ZIndex="999">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="👆" FontSize="24" Margin="0,0,10,0"/>
                <TextBlock Text="Удерживайте для перемещения" 
                          Foreground="White" 
                          FontSize="16" 
                          FontWeight="SemiBold"
                          VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Индикатор прогресса долгого нажатия -->
        <Border x:Name="LongPressIndicator"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,140,0,0"
                Background="#34495e"
                CornerRadius="10"
                Padding="15"
                Visibility="Collapsed"
                Opacity="0.9"
                Panel.ZIndex="1000">
            <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                <Grid Width="60" Height="60" Margin="0,0,0,10">
                    <Ellipse Stroke="#4a6572" StrokeThickness="3"/>
                    <Ellipse x:Name="LongPressProgressEllipse" 
                            Stroke="#e74c3c" 
                            StrokeThickness="3"
                            StrokeDashArray="0,1000"
                            RenderTransformOrigin="0.5,0.5">
                        <Ellipse.RenderTransform>
                            <RotateTransform Angle="-90"/>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <TextBlock x:Name="LongPressProgressText" 
                              Text="0.5" 
                              Foreground="White" 
                              FontSize="14" 
                              FontWeight="Bold"
                              HorizontalAlignment="Center" 
                              VerticalAlignment="Center"/>
                </Grid>
                <TextBlock Text="Удерживайте для перемещения..." 
                          Foreground="White" 
                          FontSize="12" 
                          TextWrapping="Wrap"
                          TextAlignment="Center"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>